# paper_abstract
-----------
## 国内外关于本选题的研究现状、水平和发展趋势，选题研究的目的和意义 等:

【研究意义】
随着物联网和工业互联网的快速发展，无论是智能手机还是嵌入式设备，绝大多数软件都是以二进制代码形式发布。在厂家的源代码无法获取或获取不便这一事实下，二进制代码分析成为工业界和学术界研究其安全问题的最佳实践。而在二进制代码分析中，代码相似度比较技术是重要的技术手段之一，因为其可以实现对恶意代码极其变种的追踪、已知漏洞检测、补丁存在性检测。

我们知道编译生成二进制代码的影响因素非常的多，同一套源代码基于不同因素的组合可以生成非常多不同二进制程序：
* CPU架构：X86、ARM、MIPS、PPC、RISC-V；
* 架构位数：32bits、64bits；
* OS：Linux、Windows、Android、鸿蒙、VxWork；
* 编译选项：O0~O3；
* 安全编译选项：BIND_NOW、NX、PIC、PIE、RELRO、SP、FS、Ftrapv等；
* 
按这些选项可以有5x2x5x4x8 =1600个组合，从中可以看出二进制代码相似度比较技术不管对学术界还是工业界来说，都是一个挑战技术。但是基于广阔的应用前景，20多年来学术界一直在不停的探索和研究新的方法想来解决这个技术挑战，并且也取得了一定的成果。下面就该方面的技术进行一些梳理。

【研究现状】
代码相似性检测具有较长的研究历史。Whale 于 1988 年首次提出将代码相似性检测过程划分为两个阶段：代码格式转换和相似度确定。后来很多检测方案都参考了这一框架并将检测过程细分为 4 个步骤，分别为*代码预处理、中间表示转换、比较单元生成和度量算法匹配。*

从历史发表的二进制代码相似度比较技术论文统计来看，有61种二进制代码相似性比较方法，这些在不同研究场所发表的论文主要发表在IEEE S&P、ACM CCS、USENIX Security、NDSS、ACSAC、RAID、ESORICS、ASIACCS、DIMVA、ICSE、FSE、ISSTA、ASE、MSR等顶级刊物上，得到如下统计数据：

* 输入比较：一对一（21种）、一对多（30种）、多对多（10种）；
* 比较方法：大多数方法使用单一类型的比较：相似性（42种）、等效性（5种）和相同（2种）；即使方法中仅使用一种类型的比较，它也可能有不同的输入比较不同；
* 分析粒度：分为输入粒度、方法粒度；有8中不同的比较粒度，分别是指令级、基本快、函数以及相关集合、执行轨迹、程序。最常见的输入粒度是函数（26个），然后是整个程序（25个）和相关的基本块（4）。最常见的方法粒度是函数（30个），然后是基本块（20）；
* 语法相似性：通过语法方法来捕获代码表示的相似性，更具体地说，它们比较指令序列。最常见的是序列中的指令在虚拟地址空间中是连续的，属于同一函数。
* 语义相似性：语义相似性是指所比较的代码是否具有类似的效果，而语法相似性则是指代码表示中的相似性。其中有26种计算语义相似度的方法。它们中的大多数以基本块粒度捕获语义，因为基本块是没有控制流的直线代码。有三种方法用于捕获语义:指令分类、输入-输出对和符号公式。
* 结构相似度：结构相似性计算二进制代码的图表示上的相似性。它位于句法和语义相似性之间，因为图可以捕获同一代码的多个句法表示，并可以用语义信息注释。结构相似性可以在不同的图上计算。常见的有控制流图CFG、过程间控制流图ICFG、调用图CG；（子）图同构—大多数结构相似性方法是检查图同构的变化，其中涉及到方法有K子图匹配、路径相似性、图嵌入。
* 基于特征的相似度：计算相似性的常见方法（28种）是将一段二进制代码表示为向量或一组特征，使得类似的二进制代码具有相似的特征向量或特征集。这里应用最多的是利用机器学习来实现。
* Hash匹配相似度：对于多维向量数据相似度快速匹配，通常使用局部敏感hash算法LSH来实现。
* 跨架构比较方法：对不同CPU架构二进制代码的相似度比较，通常跨体系结构方法通过计算语义相似性来实现。方法之一是通过转换成与架构无关的中间语言IR来处理（7种），另外一种是使用基于特征的相似性方法（9种）。
* 分析类型：从分析类型来看有：静态分析、动态分析、数据流分析3种类型；
* 归一化方法：语法相似性方法通常会对指令进行规范化，来尽量减少语法上的差异；有33种方法使用指令规范化。具体的包括操作数移除法、操作数归一化法、助记符归一化法。

目前的研究成果解决了其中的一些问题，但仍存在一定的不足：
* 在汇编代码获取方面，
目前的二进制程序基地址获取方法仍不完善，限制了二进制文件反汇编的正确率，而Zhu 等人的方法只能用于检测 ARM 架构的二进制程序，无法处理 MIPS 架构程序。
* 在相似性分析的鲁棒性和效率方面，
* FirmUp 需要进行繁琐的中间语言转换和复杂的程序切片，分析效率较低，难以用于大规模程序安全性检查；
* discovRE 虽然加入了过滤器，将明显不相似的一部分函数进行了过滤，一定程度上提高了分析的效率，但函数之间的相似性比较仍依赖于昂贵的图匹配算法，计算复杂度仍然较高；
* Gemini 通过图嵌入的方式实现了效率较高的函数控制流图比较，但 Gemini 使用的基本块仍是手动选择的标记或描述性统计特征，没有考虑特征对于函数区分的重要性以及特征之间的相互关系；
* InnerEye 使用神经机器翻译的方法自动化提取基本块的语义信息，较好地解决了跨指令集基本块语义比较的问题，但没能更好地进行更大粒度的相似性分析；
* Asm2Vec 和 DeepBinDiff 很好地消除了不同编译器和代码混淆对代码相似性分析的影响，在相同架构二进制代码相似性比较中取得了很好的效果，但研究的对象是相同指令集下的二进制程序，没有试图解决跨架构问题。
* 在确保相似性分析的灵活性方面，
现有方法大都是以二进制函数或可执行文件为研究对象，解决的都是函数与函数的相似性比较、可执行文件和可执行文件的相似性比较，而没有对其他比较形式展开研究。我们将主要针对特征对于函数区分的重要性以及特征之间的相互关系进行考虑。

-----------
## 选题研究的计划进度及可行性论述等:

【计划进度】
2022.1月至中旬 收集资料
2022.3月前 进行论文设计
2022.3月 完成初稿
2022.4月至上旬至中旬 修改初稿
2022.4月下旬 修改二稿
2022.5月上旬 修盖三稿
2022.5月中旬 毕业论文定稿，准备答辩
2022.6月 论文答辩

【可行性论述】
* 在前文所述的不同研究角度中，针对现有图神经网络对函数控制流图的信息利用不足的问题，我们将对现有图神经网络模型尝试进行改进。因此，我们将提出一种基于数据流图与图神经网络的 CFG 嵌入方法，利用改进后的模型从函数 CFG 图的拓扑结构和节点的相似特征中学习整个函数的嵌入向量，最后用向量间的余弦距离来度量函数间相似性。
* 这种方案也会用到Gemini算法中（使用特征提取方法将控制流图中的每个block表示成低维的向量，再使用Structure2vec算法计算图嵌入，最后利用孪生网络计算相似度得分并使用梯度下降算法训练模型）的过程，因而也可能需要考虑提取特征的选择问题和提取过程损失语义信息的问题。针对上述这个可能的问题，文献[4]提出了一种专门提取代码语义信息的模块机制，该模块的输入是二进制代码的控制流图，然后使用BERT2模型对控制流图作预训练，从而获得block的语义信息，这里将控制流图的block看作句子，block中的token看作词语。在经过预训练的操作之后，再使用MPN N(Message Passing Neural Network，消息传递神经网络) 模型计算
控制流图的graph semantic&structural embedding，即可以得到控制流图在语义和结构上的嵌入，它是一个向量的表示形式。
* 逆向分析在资源库中能查询到大量相关文献，尽管话题不新但是技术难度大，需要从低级语义分析变更到高级语义或语用的分析上来，需要能够处理进化性、可解释性带来的问题挑战，并伴随着闭源和安全对抗的需要，会持续活跃下去；
* 指导老师与师兄在理论研究、组织文章逻辑等方面会给予方向和实践指导；
落实措施：
* 结合中国知网、万方、维普等学术型专业网站，查阅，收集相关资料，对论文题目和范围有总体把握；
* 尽早对所用到的操作工具进行实践；

-----------
## 毕业论文（设计）撰写提纲:

本文共分为 7 个章节，各章节主要内容如下： 

第一部分:绪论
* 首先介绍软件工程中由脆弱性代码复用所带来的日趋严峻的安全威胁，从而阐明二进制代码相似性检测技术的研究意义，并简单介绍代码相似性的相关概念；
* 然后通过对现有二进制代码相似性检测技术及其成果的研究和分类，总结出该领域未来的研究方向及需要解决的问题；
* 最后确定本文的研究目标，介绍研究思路和内容。 

第二部分:原因分析与解决思路 ;
* 处理过程分为代码预处理、中间表示转换、比较单元生成和度量算法匹配：  
* 预处理部分的目的是剔除与代码相似性无关或影响较小的信息，同时规范和统一系统输入的格式，一般包括代码格式统一、无关字符（如空行、注释）去除、名称符号（如自定义函数名、数据名和通用寄存器名）规范和程序切片等操作。预处理部分将生成表达二进制程序的进程间数据流图和基本块特征的向量，借助 IDA Pro 来提取基本块信息。BinDiff是一款二进制文件比较工具，能够快速分析汇编代码之间的差异性和相似性，它是一款基于图形和指纹理论开发的 IDA Pro的插件，其相似函数的匹配方法主要是基于从 CFG 中得到的 NEC 值实现的，其中 NEC 即基本块数（Nodes）、边数（Edges）、调用数（Calls）。 
* 中间表示转换的目的是在尽量不改变代码携带信息的前提下，提取感兴趣的信息（如字节流、字符串、可度量的属性、程序控制流和数据流、代码的词法语法和语义）并将其转化为程序可以自动化处理和比较的其他形式。这一步一般需要借助编译器、反编译器、程序分析器、自定义规则等进行转换。中间表示的常见形式有线性结构（如字符串、标识符序列）、树形结构（如抽象语法树、XML 文档）、图形结构（如控制流图、数据流图）和其他非线性结构（如向量、矩阵）。
* 比较单元生成是对代码或其中间表示进行切分或聚合操作，得到便于进行相似性匹配或度量的单元。常见的比较单元有字符串、标识符序列、特征向量、树的结点及子树、图的节点及子图等，也可以是中间表示的本身。该部分首先将两个合并为一个图，然后使用文本相关的深度游走算法（Text-associated DeepWalk，TADW）生成基本块嵌入向量，并通过使用交替最小二乘法进行多次优化。 
* 代码相似度计算部分，利用 k-hop 贪婪匹配算法，根据已经匹配的基本块的 k-hop 邻居嵌入向量的相似度寻找匹配基本块。  
  
第三部分:实现与测试 ;

第四部分:总结与展望 ;

-----------
## 参考文献:

[1] 二进制代码相似性分析关键问题研究 朱晓东

[2] 二进制代码相似性搜索研究进展 夏冰,庞建民,周鑫,单征

[3] Duan Y, Li X, Wang J, et al. DeepBinDiff: Learning Program-Wide Code Representations for Binary Diffing [C]. In Proceedings of the Network and Distributed Security Symposium (NDSS). 2020.

[4] Yu Z， Ca oR， Tang Q， etal.OrderMatters：Semantic-AwareNeuralNet works for Binary Code Similarity Detection[C] .Proceedings of the AAAI Conference on Artificial Intelligence.2020， 34(1) ：1145-1152.

[5] 基于神经网络的二进制代码相似性关键技术研究 方磊
